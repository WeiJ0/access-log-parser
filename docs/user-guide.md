# Apache Access Log Analyzer 使用手冊

> 繁體中文完整使用指南

## 目錄

1. [快速開始](#快速開始)
2. [基本操作](#基本操作)
3. [進階功能](#進階功能)
4. [常見問題](#常見問題)
5. [效能建議](#效能建議)
6. [疑難排解](#疑難排解)

## 快速開始

### 系統需求

#### Windows
- **作業系統**: Windows 10 (版本 1809 或更新) / Windows 11
- **WebView2**: Windows 11 內建，Windows 10 需要安裝
- **記憶體**: 建議 4GB RAM 以上
- **硬碟空間**: 至少 100MB 可用空間

#### macOS
- **作業系統**: macOS 10.15 Catalina 或更新版本
- **記憶體**: 建議 4GB RAM 以上
- **硬碟空間**: 至少 100MB 可用空間

#### Linux
- **作業系統**: Ubuntu 20.04+ / Fedora 36+ / Debian 11+
- **依賴**: GTK3, WebKitGTK
- **記憶體**: 建議 4GB RAM 以上
- **硬碟空間**: 至少 100MB 可用空間

### 首次安裝

#### Windows

1. 下載安裝程式 `apache-log-analyzer-setup.exe`
2. 雙擊執行安裝程式
3. 選擇安裝位置（預設：`C:\Program Files\Apache Log Analyzer`）
4. 完成安裝後，從「開始」選單啟動應用程式
5. 如果提示缺少 WebView2，點擊「下載並安裝」

**WebView2 手動安裝**:
如果自動安裝失敗，請前往：
https://developer.microsoft.com/zh-tw/microsoft-edge/webview2/

#### macOS

1. 下載 `.dmg` 檔案
2. 開啟 DMG 檔案
3. 將應用程式圖示拖曳到「應用程式」資料夾
4. 首次開啟時，右鍵點擊應用程式，選擇「開啟」
5. 在安全性提示中，點擊「開啟」確認

#### Linux

```bash
# 下載 AppImage
wget https://github.com/yourusername/access-log-analyzer/releases/latest/download/apache-log-analyzer-linux-amd64.AppImage

# 賦予執行權限
chmod +x apache-log-analyzer-linux-amd64.AppImage

# 執行應用程式
./apache-log-analyzer-linux-amd64.AppImage
```

**Ubuntu/Debian 依賴安裝**:
```bash
sudo apt-get install libgtk-3-0 libwebkit2gtk-4.0-37
```

**Fedora 依賴安裝**:
```bash
sudo dnf install gtk3 webkit2gtk3
```

## 基本操作

### 1. 載入日誌檔案

#### 步驟 1: 開啟檔案對話框

![開啟檔案](images/open-file.png)

1. 點擊工具列的「開啟檔案」按鈕
2. 或使用快捷鍵 `Ctrl+O` (Windows/Linux) / `Cmd+O` (macOS)

#### 步驟 2: 選擇日誌檔案

支援的檔案格式：
- `.log` - Apache 存取日誌
- `.txt` - 文字格式的日誌
- 任何文字檔案（無副檔名限制）

**檔案大小限制**: 最大 10GB

#### 步驟 3: 等待解析完成

![解析進度](images/parsing-progress.png)

- 進度條顯示解析狀態
- 顯示已處理的行數
- 顯示解析速度（MB/秒）
- 大型檔案可能需要數秒到數分鐘

**預期解析時間**:
- 10MB 檔案: ~0.1 秒
- 100MB 檔案: ~1.5 秒
- 1GB 檔案: ~15 秒
- 10GB 檔案: ~2-3 分鐘

#### 步驟 4: 檢視解析結果

![日誌表格](images/log-table.png)

解析完成後，您會看到：
- 日誌條目表格（顯示所有欄位）
- 錯誤摘要（如果有解析錯誤）
- 總記錄數和處理時間

### 2. 檢視日誌表格

#### 表格欄位說明

| 欄位 | 說明 | 範例 |
|------|------|------|
| IP 位址 | 客戶端 IP | `192.168.1.100` |
| 時間戳 | 請求時間 | `2025-01-15 14:30:25` |
| 方法 | HTTP 方法 | `GET`, `POST`, `PUT` |
| 路徑 | 請求路徑 | `/index.html` |
| 協定 | HTTP 協定 | `HTTP/1.1` |
| 狀態碼 | 回應狀態碼 | `200`, `404`, `500` |
| 大小 | 回應大小（bytes） | `1024` |
| Referer | 來源網址 | `https://example.com/` |
| User Agent | 使用者代理 | `Mozilla/5.0...` |

#### 表格操作

**排序**:
- 點擊欄位標題進行排序
- 再次點擊切換升序/降序
- 支援多欄位排序（按住 Shift 點擊）

**調整欄寬**:
- 拖曳欄位分隔線調整寬度
- 雙擊分隔線自動調整至適合寬度

**捲動**:
- 使用滾輪或觸控板捲動
- 拖曳捲軸快速移動
- 虛擬化支援：流暢顯示百萬筆記錄

### 3. 檢視統計儀表板

![統計儀表板](images/dashboard.png)

#### 切換到儀表板

1. 點擊頂部的「儀表板」分頁
2. 查看自動計算的統計資訊

#### 統計資訊類型

##### Top 10 IP 位址

顯示請求最多的 10 個 IP 位址：
- **IP 位址**: 客戶端 IP
- **請求數**: 該 IP 的總請求數
- **流量**: 該 IP 的總傳輸量（MB）
- **錯誤率**: 4xx/5xx 錯誤的百分比

**解讀提示**:
- 請求數異常高的 IP 可能是爬蟲或攻擊者
- 高錯誤率可能表示客戶端問題或授權失敗

##### Top 10 請求路徑

顯示最常被訪問的 10 個路徑：
- **路徑**: 請求的 URL 路徑
- **請求數**: 該路徑的訪問次數
- **平均大小**: 該路徑回應的平均大小
- **錯誤率**: 該路徑的錯誤百分比

**解讀提示**:
- 找出最受歡迎的頁面或 API 端點
- 高錯誤率的路徑可能需要修復

##### 狀態碼分布

顯示 HTTP 狀態碼的分布情況：
- **2xx (成功)**: 請求成功處理
- **3xx (重定向)**: 資源已移動
- **4xx (客戶端錯誤)**: 請求錯誤（如 404 Not Found）
- **5xx (伺服器錯誤)**: 伺服器端錯誤

**健康指標**:
- ✅ 正常：2xx > 90%, 5xx < 1%
- ⚠️ 注意：2xx 70-90%, 5xx 1-5%
- ❌ 異常：2xx < 70%, 5xx > 5%

##### 機器人流量偵測

自動識別爬蟲和機器人流量：
- **IP 位址**: 機器人的 IP
- **類型**: Crawler（爬蟲）、Bot（機器人）、Scraper（抓取器）
- **信心分數**: 0.0-1.0，越高越確定
- **請求數**: 該機器人的總請求數

**信心分數說明**:
- **0.9-1.0**: 高信心（明確的機器人關鍵字，如 "Googlebot"）
- **0.7-0.9**: 中信心（常見機器人特徵）
- **0.5-0.7**: 低信心（可疑特徵）

### 4. 搜尋和篩選

#### 全文搜尋

![搜尋框](images/search-bar.png)

1. 在表格上方的搜尋框輸入關鍵字
2. 系統即時搜尋以下欄位：
   - IP 位址
   - 請求路徑
   - User Agent
3. 表格立即更新顯示符合的記錄
4. 點擊「清除」按鈕恢復顯示所有記錄

**搜尋範例**:
- 搜尋特定 IP: `192.168.1.100`
- 搜尋特定路徑: `/api/users`
- 搜尋 bot: `googlebot`

**搜尋技巧**:
- 搜尋支援部分匹配（不區分大小寫）
- 使用防抖技術，輸入暫停 300ms 後才搜尋
- 支援即時更新，輸入時立即顯示結果

#### 進階篩選

![篩選器面板](images/filter-panel.png)

1. 點擊「篩選器」按鈕開啟篩選面板
2. 設定篩選條件：

**狀態碼篩選**:
- 選擇一個或多個狀態碼範圍
- 選項：2xx、3xx、4xx、5xx
- 支援多選（同時篩選多個範圍）

**時間範圍篩選**:
- 選擇開始時間和結束時間
- 使用日期時間選擇器
- 只顯示該時間範圍內的記錄

**複合篩選**:
- 搜尋和篩選可以同時使用
- 例如：搜尋特定 IP + 篩選 4xx 錯誤

#### 清除篩選

點擊「清除篩選」按鈕可以：
- 清除所有搜尋條件
- 重置所有篩選器
- 恢復顯示所有記錄

### 5. 匯出 Excel 報告

![匯出進度](images/export-progress.png)

#### 步驟 1: 開始匯出

1. 點擊「匯出 Excel」按鈕
2. 選擇儲存位置和檔案名稱
3. 建議檔名格式：`access_log_analysis_2025-01-15.xlsx`

#### 步驟 2: 等待匯出完成

- 進度對話框顯示匯出狀態
- 顯示已處理的記錄數
- 大型資料集可能需要較長時間

**預期匯出時間**:
- 10,000 筆記錄: ~1 秒
- 100,000 筆記錄: ~5 秒
- 1,000,000 筆記錄: ~30 秒

#### 步驟 3: 開啟 Excel 檔案

匯出完成後，Excel 檔案包含三個工作表：

##### 工作表 1: 日誌條目 (Logs)

完整的日誌記錄表格，包含所有欄位：
- IP 位址、時間戳、方法、路徑、協定
- 狀態碼、大小、Referer、User Agent

**格式設定**:
- 標題列粗體，背景色
- 時間戳格式：`YYYY-MM-DD HH:MM:SS`
- 數字格式：千分位分隔符號

##### 工作表 2: 統計資料 (Statistics)

包含三個區塊：

**Top 10 IP 位址**:
| IP 位址 | 請求數 | 流量 (MB) | 錯誤率 (%) |
|---------|--------|-----------|-----------|

**Top 10 請求路徑**:
| 路徑 | 請求數 | 平均大小 (bytes) | 錯誤率 (%) |
|------|--------|-----------------|-----------|

**狀態碼分布**:
| 類別 | 數量 | 百分比 (%) |
|------|------|-----------|

##### 工作表 3: 機器人偵測 (Bots)

| IP 位址 | 類型 | 信心分數 | 請求數 |
|---------|------|----------|--------|

#### Excel 行數限制

- **Excel 2007+**: 最大 1,048,576 行
- 如果日誌記錄超過此限制：
  - 系統自動截斷
  - 顯示警告訊息
  - 統計資料仍基於完整資料計算

**建議**:
- 對於超大檔案，考慮先篩選再匯出
- 或使用多個匯出分批處理

## 進階功能

### 多檔案分頁管理

![多檔案分頁](images/multi-tabs.png)

#### 開啟多個檔案

1. 載入第一個日誌檔案
2. 再次點擊「開啟檔案」載入第二個檔案
3. 系統自動建立新分頁
4. 每個分頁顯示不同檔案的內容

#### 分頁操作

- **切換分頁**: 點擊分頁標籤
- **關閉分頁**: 點擊分頁上的「×」按鈕
- **獨立狀態**: 每個分頁有獨立的：
  - 日誌記錄
  - 統計資料
  - 搜尋條件
  - 篩選設定

#### 分頁標籤顯示

- 檔案名稱（不含路徑）
- 記錄數量
- 例如：`access.log (125,430 筆)`

### 鍵盤快捷鍵

| 快捷鍵 | 功能 | Windows/Linux | macOS |
|--------|------|---------------|-------|
| 開啟檔案 | 開啟檔案對話框 | `Ctrl+O` | `Cmd+O` |
| 匯出 Excel | 開始匯出 | `Ctrl+S` | `Cmd+S` |
| 搜尋 | 聚焦搜尋框 | `Ctrl+F` | `Cmd+F` |
| 清除搜尋 | 清除搜尋條件 | `Esc` | `Esc` |
| 切換分頁 | 下一個分頁 | `Ctrl+Tab` | `Cmd+Tab` |
| 關閉分頁 | 關閉當前分頁 | `Ctrl+W` | `Cmd+W` |

### 深色模式

![深色模式](images/dark-mode.png)

#### 啟用深色模式

1. 點擊右上角的「設定」圖示
2. 選擇「深色模式」
3. 介面立即切換為深色主題

#### 主題特色

- **淺色模式**: 白色背景，適合明亮環境
- **深色模式**: 暗色背景，減少眼睛疲勞

### 最近開啟的檔案

![最近檔案](images/recent-files.png)

#### 快速重新開啟

1. 點擊「檔案」選單
2. 選擇「最近開啟的檔案」
3. 點擊檔案路徑快速載入

#### 管理最近檔案

- 系統自動記錄最近 10 個檔案
- 點擊「清除列表」可清空記錄
- 檔案不存在時自動從列表移除

## 效能建議

### 記憶體使用

**預期記憶體使用** = 檔案大小 × 3.3

範例：
- 100MB 檔案: ~330MB RAM
- 1GB 檔案: ~3.3GB RAM
- 10GB 檔案: ~33GB RAM（需要高階硬體）

**為什麼需要這麼多記憶體？**
- 需要保留所有記錄供 GUI 顯示
- 支援即時搜尋和篩選
- 虛擬化表格需要完整資料集

**記憶體優化建議**:
1. 關閉不需要的分頁
2. 處理超大檔案時，考慮：
   - 先用文字編輯器分割檔案
   - 只載入特定時間範圍的日誌
3. 確保系統有足夠的可用記憶體

### 效能最佳化

#### 大檔案處理技巧

**10GB 檔案處理**:
1. 確保系統有 40GB+ 可用記憶體
2. 關閉其他應用程式
3. 預期處理時間：2-3 分鐘
4. 匯出可能需要額外 3-5 分鐘

**檔案分割建議**:
```bash
# Linux/macOS: 使用 split 命令
split -l 1000000 access.log access_part_

# Windows: 使用 PowerShell
Get-Content access.log | Select-Object -First 1000000 | Set-Content access_part_1.log
```

#### CPU 使用

- 解析器使用 4 個並發 workers
- 自動利用多核心 CPU
- 單核心效能較低，建議 4 核心以上

#### 磁碟 I/O

- 使用 SSD 可顯著提升載入速度
- HDD 可能成為效能瓶頸
- 匯出大檔案時確保磁碟有足夠空間

## 常見問題

### Q1: 支援哪些日誌格式？

**A**: 目前支援 Apache Combined 和 Common Log Format：

**Combined Log Format**:
```
192.168.1.1 - - [15/Jan/2025:14:30:25 +0800] "GET /index.html HTTP/1.1" 200 1024 "https://example.com/" "Mozilla/5.0..."
```

**Common Log Format**:
```
192.168.1.1 - - [15/Jan/2025:14:30:25 +0800] "GET /index.html HTTP/1.1" 200 1024
```

未來版本計畫支援 Nginx 和自訂格式。

### Q2: 檔案太大無法載入怎麼辦？

**A**: 幾種解決方案：

1. **分割檔案**: 使用系統工具分割為多個小檔案
2. **增加記憶體**: 升級系統 RAM
3. **時間範圍篩選**: 先用文字編輯器提取特定時間範圍
4. **伺服器端處理**: 在伺服器上預處理後再下載

### Q3: 解析速度很慢怎麼辦？

**可能原因**:
- CPU 效能不足（建議 4 核心以上）
- HDD 讀取速度慢（建議使用 SSD）
- 系統記憶體不足（關閉其他應用程式）
- 防毒軟體掃描（暫時停用即時掃描）

**優化步驟**:
1. 檢查系統資源使用情況
2. 升級硬體（CPU, SSD, RAM）
3. 確保足夠的可用磁碟空間

### Q4: 為什麼有些行解析失敗？

**常見原因**:
- 日誌格式不符（非 Apache Combined/Common Format）
- 行被截斷或損壞
- 特殊字元編碼問題
- 自訂日誌格式

**解決方法**:
1. 檢視「錯誤摘要」了解失敗原因
2. 檢查日誌格式配置
3. 確認編碼為 UTF-8
4. 損壞的行會被跳過，不影響其他記錄

### Q5: 匯出的 Excel 檔案無法開啟？

**檢查事項**:
1. 檔案大小是否正常（不是 0 bytes）
2. Excel 版本是否為 2007 以上
3. 檔案路徑是否包含特殊字元
4. 磁碟空間是否足夠

**解決步驟**:
1. 嘗試用 Google Sheets 開啟
2. 確認匯出過程沒有錯誤訊息
3. 重新匯出到不同位置

### Q6: 統計資料不準確？

**A**: 統計資料基於成功解析的記錄計算。如果有很多解析失敗的行，統計可能不完整。檢查「錯誤摘要」了解失敗比例。

### Q7: 機器人偵測有誤判嗎？

**A**: 機器人偵測基於 User-Agent 關鍵字匹配，可能有以下情況：
- **誤判為機器人**: User-Agent 包含 "bot" 等關鍵字的正常瀏覽器
- **未偵測**: 偽裝 User-Agent 的機器人

信心分數可作為參考，0.9+ 的結果較為可靠。

### Q8: 支援 Nginx 日誌嗎？

**A**: 當前版本僅支援 Apache 格式。Nginx 支援已在規劃中，預計在下一個主要版本推出。

### Q9: 可以分析即時日誌嗎？

**A**: 當前版本僅支援靜態檔案分析。即時監控（tail -f 模式）已在長期規劃中。

### Q10: 如何提供意見回饋？

**A**: 歡迎透過以下方式聯繫：
- GitHub Issues: https://github.com/yourusername/access-log-analyzer/issues
- Email: your.email@example.com

## 疑難排解

### Windows 相關問題

#### WebView2 安裝失敗

**症狀**: 應用程式無法啟動，提示缺少 WebView2

**解決方法**:
1. 手動下載 WebView2 Runtime:
   https://developer.microsoft.com/zh-tw/microsoft-edge/webview2/
2. 安裝 Evergreen Standalone Installer
3. 重新啟動應用程式

#### 防毒軟體阻擋

**症狀**: 應用程式被防毒軟體隔離或無法執行

**解決方法**:
1. 將應用程式加入防毒軟體白名單
2. 暫時停用即時掃描
3. 檢查數位簽章是否有效

### macOS 相關問題

#### 無法開啟應用程式

**症狀**: 提示「無法開啟 XXX，因為它來自未識別的開發者」

**解決方法**:
1. 右鍵點擊應用程式
2. 選擇「開啟」
3. 在對話框中再次點擊「開啟」

**或使用終端機**:
```bash
xattr -cr /Applications/apache-log-analyzer.app
```

#### 效能問題

**症狀**: M1/M2 Mac 上執行緩慢

**原因**: 可能使用了 Intel 版本（Rosetta 2 轉譯）

**解決方法**:
下載 ARM64 版本：`apache-log-analyzer-darwin-arm64.dmg`

### Linux 相關問題

#### AppImage 無法執行

**症狀**: 雙擊 AppImage 沒有反應

**解決方法**:
```bash
# 確認檔案有執行權限
ls -l apache-log-analyzer-linux-amd64.AppImage

# 如果沒有執行權限，設定權限
chmod +x apache-log-analyzer-linux-amd64.AppImage

# 執行
./apache-log-analyzer-linux-amd64.AppImage
```

#### 缺少依賴庫

**症狀**: 提示缺少 `libgtk-3.so` 或 `libwebkit2gtk`

**解決方法**:
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install libgtk-3-0 libwebkit2gtk-4.0-37

# Fedora
sudo dnf install gtk3 webkit2gtk3

# Arch Linux
sudo pacman -S gtk3 webkit2gtk
```

### 通用問題

#### 應用程式崩潰

**收集錯誤資訊**:
1. 檢查日誌檔案：
   - Windows: `%APPDATA%\apache-log-analyzer\app.log`
   - macOS: `~/Library/Application Support/apache-log-analyzer/app.log`
   - Linux: `~/.config/apache-log-analyzer/app.log`
2. 記錄崩潰前的操作步驟
3. 提供系統資訊（OS 版本、記憶體大小）
4. 提交 Issue 到 GitHub

#### 記憶體不足

**症狀**: 
- 應用程式反應緩慢
- 系統提示記憶體不足
- 應用程式崩潰

**解決方法**:
1. 關閉其他應用程式釋放記憶體
2. 關閉不需要的分頁
3. 處理較小的檔案
4. 升級系統記憶體

#### 介面顯示異常

**症狀**: 文字重疊、按鈕錯位

**解決方法**:
1. 調整視窗大小
2. 重新啟動應用程式
3. 檢查顯示比例設定（建議 100%）
4. 更新顯示卡驅動程式

## 附錄

### 支援的狀態碼

| 狀態碼範圍 | 類別 | 說明 |
|-----------|------|------|
| 200-299 | 2xx | 成功 - 請求被成功接收、理解和處理 |
| 300-399 | 3xx | 重定向 - 需要進一步操作以完成請求 |
| 400-499 | 4xx | 客戶端錯誤 - 請求包含錯誤或無法完成 |
| 500-599 | 5xx | 伺服器錯誤 - 伺服器無法完成有效的請求 |

### 常見狀態碼

| 狀態碼 | 訊息 | 說明 |
|-------|------|------|
| 200 | OK | 成功 |
| 301 | Moved Permanently | 永久重定向 |
| 302 | Found | 暫時重定向 |
| 304 | Not Modified | 快取有效 |
| 400 | Bad Request | 錯誤的請求 |
| 401 | Unauthorized | 未授權 |
| 403 | Forbidden | 禁止訪問 |
| 404 | Not Found | 找不到頁面 |
| 500 | Internal Server Error | 伺服器內部錯誤 |
| 502 | Bad Gateway | 閘道錯誤 |
| 503 | Service Unavailable | 服務不可用 |

### 機器人類型說明

| 類型 | 說明 | 範例 |
|------|------|------|
| Crawler | 搜尋引擎爬蟲 | Googlebot, Bingbot |
| Bot | 一般機器人 | Facebook Bot, Telegram Bot |
| Scraper | 資料抓取器 | Python-requests, curl |
| Monitor | 監控服務 | UptimeRobot, Pingdom |

### 技術支援

如需進一步協助，請聯繫：

- **GitHub Issues**: https://github.com/yourusername/access-log-analyzer/issues
- **Email**: your.email@example.com
- **文檔**: https://github.com/yourusername/access-log-analyzer/wiki

---

**版本**: 1.0.0  
**最後更新**: 2025-01-15  
**語言**: 繁體中文

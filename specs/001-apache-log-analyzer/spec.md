# Feature Specification: Apache Access Log Analyzer

**Feature Branch**: `001-apache-log-analyzer`  
**Created**: 2025-11-06  
**Status**: Draft  
**Input**: User description: "我要製作一個 parser apache 伺服器所下載下來的 access log parser，會是一個 GUI 介面，可以讓使用者選擇 log 檔案，並且使用最有效率的方式來讀取檔案，並且能夠轉換成表格顯示，並且列出最多連線的 IP、頁面以及 user agent 有沒有表明是 bot，還有 status code 等等應該讓使用者得知的資訊，會有一個類似儀表板的頁面，以及最終能將其表格匯出成 xlxs 的功能"

## Clarifications

### Session 2025-11-06

- Q: 當使用者選擇多個 log 檔案時，系統應該如何組織和顯示這些資料？ → A: 分頁檢視 - 每個檔案在獨立分頁中顯示，使用者可切換檢視不同檔案
- Q: 儀表板中的統計資料應該使用什麼類型的視覺化圖表來呈現？ → A: 純文字列表 - 不使用圖表，僅用排序列表顯示數據
- Q: 當 log 檔案包含損壞或格式不正確的記錄行時，系統應該如何處理這些錯誤？ → A: 記錄並跳過，顯示錯誤摘要 - 繼續處理其他記錄，在完成後顯示跳過的行數和錯誤樣本
- Q: 當解析包含 100 萬筆以上記錄的大型檔案時，表格應該如何處理顯示以保持效能？ → A: 虛擬化捲動 - 只渲染視窗中可見的行，捲動時動態載入
- Q: 當多個檔案同時開啟時，儀表板的統計資料應該如何計算和顯示？ → A: 每個分頁獨立統計 - 切換分頁時顯示該檔案的統計資料

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 載入並解析 Log 檔案 (Priority: P1)

系統管理員需要快速檢視 Apache 伺服器的存取日誌，以了解伺服器的使用狀況。使用者透過 GUI 介面選擇一個或多個 access log 檔案，系統自動解析檔案內容並以表格形式呈現所有日誌記錄。

**Why this priority**: 這是核心功能，沒有檔案載入和解析就無法進行任何後續分析。這是 MVP 的基礎。

**Independent Test**: 使用者可以選擇一個 Apache access log 檔案，系統成功解析並在表格中顯示所有日誌條目（包含 IP、時間戳、請求路徑、狀態碼、User Agent 等欄位）。

**Acceptance Scenarios**:

1. **Given** 使用者啟動應用程式，**When** 使用者點擊「選擇檔案」按鈕並選擇一個有效的 Apache access log 檔案，**Then** 系統在 5 秒內完成解析並在表格中顯示所有日誌條目
2. **Given** 使用者選擇了一個大型 log 檔案（>100MB），**When** 系統開始解析，**Then** 顯示進度指示器並在合理時間內完成解析
3. **Given** 使用者選擇了一個非 Apache log 格式的檔案，**When** 系統嘗試解析，**Then** 顯示友善的錯誤訊息說明檔案格式不符
4. **Given** 表格中顯示日誌資料，**When** 使用者捲動表格，**Then** 可以流暢地瀏覽所有記錄
5. **Given** 使用者選擇了一個空的 log 檔案，**When** 系統解析完成，**Then** 顯示訊息說明檔案為空但不會崩潰

---

### User Story 2 - 儀表板統計分析 (Priority: P2)

系統管理員需要快速了解伺服器的關鍵指標，例如最活躍的 IP 位址、最常被存取的頁面、機器人流量比例，以及各種 HTTP 狀態碼的分布情況。使用者切換到儀表板檢視，系統自動計算並以排序列表形式呈現這些統計資訊。

**Why this priority**: 統計分析是日誌分析工具的核心價值,幫助使用者快速識別問題和趨勢。儀表板提供整體概覽。

**Independent Test**: 載入 log 檔案後，切換到儀表板檢視，可以看到 Top 10 IP 位址、Top 10 頁面、狀態碼分布列表、機器人 vs 真實使用者比例等統計資訊。

**Acceptance Scenarios**:

1. **Given** 系統已載入並解析 log 檔案，**When** 使用者切換到儀表板檢視，**Then** 顯示 Top 10 連線最多的 IP 位址及其連線次數
2. **Given** 儀表板顯示中，**When** 使用者檢視頁面存取統計，**Then** 顯示 Top 10 最常被存取的頁面路徑及其存取次數
3. **Given** 儀表板顯示中，**When** 使用者檢視 User Agent 分析，**Then** 顯示機器人（bot）與真實使用者的流量比例，並列出識別出的機器人類型
4. **Given** 儀表板顯示中，**When** 使用者檢視狀態碼分析，**Then** 顯示各種 HTTP 狀態碼（2xx, 3xx, 4xx, 5xx）的數量分布
5. **Given** 儀表板中的任一統計項目，**When** 使用者點擊該項目，**Then** 可以查看更詳細的資訊或過濾表格資料
6. **Given** 使用者在儀表板檢視統計資料，**When** 資料量很大，**Then** 統計計算在 3 秒內完成並顯示結果

---

### User Story 3 - 匯出分析結果 (Priority: P3)

系統管理員需要將分析結果儲存為 Excel 檔案，以便與團隊分享或進行進一步的離線分析。使用者點擊匯出按鈕，選擇要匯出的內容（完整表格或篩選後的資料），系統生成包含格式化資料的 XLSX 檔案。

**Why this priority**: 匯出功能增加工具的實用性，但不影響核心分析功能。使用者可以先完成分析再決定是否需要匯出。

**Independent Test**: 載入並分析 log 檔案後，點擊匯出按鈕，選擇儲存位置，系統生成包含所有日誌記錄和統計摘要的 XLSX 檔案。

**Acceptance Scenarios**:

1. **Given** 系統已載入日誌資料，**When** 使用者點擊「匯出為 Excel」按鈕，**Then** 開啟檔案儲存對話框讓使用者選擇儲存位置和檔名
2. **Given** 使用者選擇了儲存位置，**When** 系統開始匯出，**Then** 生成包含完整表格資料的 XLSX 檔案
3. **Given** 使用者對表格套用了篩選條件，**When** 使用者匯出資料，**Then** 僅匯出符合篩選條件的記錄
4. **Given** 匯出過程中，**When** 資料量很大，**Then** 顯示進度指示器並在完成後通知使用者
5. **Given** XLSX 檔案已生成，**When** 使用者開啟檔案，**Then** 檔案包含正確的欄位標題和資料格式
6. **Given** 使用者選擇匯出儀表板統計資料，**When** 匯出完成，**Then** XLSX 檔案包含額外的工作表顯示統計圖表和摘要

---

### User Story 4 - 資料篩選與搜尋 (Priority: P4)

系統管理員需要快速找到特定的日誌記錄，例如來自特定 IP 的請求、特定時間範圍的記錄、或包含特定狀態碼的請求。使用者使用篩選功能和搜尋框來縮小結果範圍。

**Why this priority**: 篩選和搜尋提升使用體驗，但核心分析功能不依賴此功能。使用者可以先瀏覽完整資料再決定是否需要篩選。

**Independent Test**: 載入 log 檔案後，在表格上方的搜尋框輸入 IP 位址或關鍵字，表格立即更新只顯示符合條件的記錄。

**Acceptance Scenarios**:

1. **Given** 表格顯示所有日誌記錄，**When** 使用者在搜尋框輸入 IP 位址，**Then** 表格即時更新只顯示來自該 IP 的記錄
2. **Given** 表格顯示中，**When** 使用者選擇狀態碼篩選器（例如只顯示 4xx 錯誤），**Then** 表格只顯示符合該狀態碼範圍的記錄
3. **Given** 表格顯示中，**When** 使用者設定時間範圍篩選，**Then** 表格只顯示該時間範圍內的記錄
4. **Given** 使用者套用了多個篩選條件，**When** 使用者清除所有篩選，**Then** 表格恢復顯示所有記錄
5. **Given** 使用者套用了篩選條件，**When** 切換到儀表板檢視，**Then** 統計資料反映篩選後的結果

---

### Edge Cases

- 當 log 檔案超過 1GB 時，系統如何處理記憶體使用避免崩潰？
- 當 log 檔案包含損壞或格式不正確的記錄行時，跳過該行並在解析完成後顯示錯誤摘要（行數和樣本）
- 當使用者同時開啟多個 log 檔案時，每個檔案分頁的儀表板統計資料獨立計算
- 當 log 檔案正在被伺服器寫入時（檔案被鎖定），系統如何處理？
- 當使用者在解析過程中關閉應用程式，如何確保資料完整性？
- 當匯出的 Excel 檔案過大（>100MB）時，系統如何優化效能？
- 當使用者選擇的檔案路徑包含特殊字元或非 ASCII 字元時如何處理？
- 當系統同時處理多個大型檔案時，如何管理記憶體和 CPU 資源？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須提供 GUI 介面讓使用者透過檔案選擇對話框選擇一個或多個 Apache access log 檔案，多個檔案時以分頁方式顯示，每個檔案在獨立分頁中
- **FR-002**: 系統必須支援標準的 Apache Combined Log Format 和 Common Log Format 的解析
- **FR-003**: 系統必須將解析後的日誌資料以表格形式呈現，包含以下欄位：IP 位址、時間戳、請求方法、請求路徑、HTTP 版本、狀態碼、回應大小、Referer、User Agent。表格必須使用虛擬化捲動技術，只渲染可見的行以保持效能
- **FR-004**: 系統必須提供儀表板檢視，顯示以下統計資訊（當開啟多個檔案時，每個分頁獨立計算統計資料）：
  - Top 10 連線次數最多的 IP 位址
  - Top 10 存取次數最多的頁面路徑
  - HTTP 狀態碼分布（2xx, 3xx, 4xx, 5xx 的數量和百分比）
  - 機器人 vs 真實使用者的流量比例
  - 識別出的機器人類型列表
- **FR-005**: 系統必須能夠識別常見的機器人 User Agent（如 Googlebot, Bingbot, crawler, spider 等關鍵字）
- **FR-006**: 系統必須提供匯出功能，將表格資料和統計摘要匯出為 XLSX 格式
- **FR-007**: 系統必須在解析大型檔案時顯示進度指示器，讓使用者了解處理進度
- **FR-008**: 系統必須支援表格欄位的排序功能（依據時間、IP、狀態碼等排序）
- **FR-009**: 系統必須提供搜尋功能，讓使用者可以搜尋特定的 IP、路徑或關鍵字
- **FR-010**: 系統必須提供篩選功能，讓使用者可以依據狀態碼、時間範圍、或其他欄位篩選資料
- **FR-011**: 系統必須在遇到無法解析的日誌行時跳過該行並繼續處理，解析完成後顯示錯誤摘要（包含跳過的行數和錯誤樣本）
- **FR-012**: 系統必須在檔案選擇錯誤或格式不符時顯示友善的錯誤訊息
- **FR-013**: 系統必須採用串流或分批讀取方式處理大型檔案，避免一次性載入整個檔案到記憶體
- **FR-014**: 系統必須允許使用者在表格和儀表板檢視之間切換
- **FR-015**: 系統必須在匯出 Excel 時包含格式化的標題列和適當的欄寬

### Assumptions

- Apache access log 檔案使用 UTF-8 編碼或系統預設編碼
- 使用者具備基本的電腦操作能力，知道如何選擇檔案和儲存檔案
- log 檔案存放在使用者可存取的本機磁碟或網路磁碟
- 使用者的作業系統為 Windows、macOS 或 Linux
- 匯出的 XLSX 檔案將使用 Office Open XML 標準格式，可被 Microsoft Excel、Google Sheets 等工具開啟
- 機器人識別基於 User Agent 字串的關鍵字匹配，不涉及複雜的行為分析

### Key Entities

- **Log Entry（日誌條目）**: 代表 access log 中的一筆記錄，包含 IP 位址、時間戳、HTTP 請求資訊、狀態碼、回應大小、Referer、User Agent 等屬性
- **IP Statistics（IP 統計）**: 彙總特定 IP 位址的連線次數、請求的頁面列表、最後連線時間等資訊
- **Page Statistics（頁面統計）**: 彙總特定頁面路徑的存取次數、不同 IP 訪問數、平均回應大小等資訊
- **Bot Detection Result（機器人檢測結果）**: 包含是否為機器人、機器人類型（如 Googlebot、Bingbot）、信心度等資訊
- **Status Code Statistics（狀態碼統計）**: 各種 HTTP 狀態碼的出現次數和百分比

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可以在 30 秒內完成從啟動應用程式到看到解析結果的完整流程（針對中等大小的 log 檔案，約 10-50MB）
- **SC-002**: 90% 的使用者能在第一次使用時成功載入並解析 log 檔案，無需查看說明文件
- **SC-003**: 系統能夠處理至少 1GB 大小的 log 檔案而不崩潰或凍結
- **SC-004**: 使用者能在 10 秒內找到特定 IP 或關鍵字相關的日誌記錄（透過搜尋或篩選功能）
- **SC-005**: 匯出的 XLSX 檔案能夠被 Microsoft Excel 2016 或更新版本、Google Sheets 正確開啟並顯示
- **SC-006**: 儀表板統計資訊的計算和顯示在 5 秒內完成（針對包含 10 萬筆記錄的 log 檔案）

### Performance Criteria *(for Go applications)*

- **PC-001**: 解析速度達到至少 50MB/秒（針對標準格式的 Apache access log）
- **PC-002**: 記憶體使用量不超過處理檔案大小的 1.5 倍，即使處理 1GB 的檔案也不超過 1.5GB RAM
- **PC-003**: 支援使用 goroutines 同時處理多個檔案的解析任務
- **PC-004**: GUI 介面啟動時間不超過 2 秒
- **PC-005**: 處理包含 100 萬筆日誌記錄的檔案時，統計分析在 10 秒內完成
- **PC-006**: 表格捲動和互動操作保持流暢，畫面更新延遲不超過 100 毫秒
- **PC-007**: 匯出 XLSX 檔案的速度至少達到每秒處理 10,000 筆記錄

### Usability Criteria

- **UC-001**: 使用者介面採用直觀的視覺設計，主要功能（載入檔案、切換檢視、匯出）在視窗中明顯可見
- **UC-002**: 所有錯誤訊息使用繁體中文，並提供明確的解決建議
- **UC-003**: 儀表板統計資訊以排序列表形式呈現，清楚標示數值和百分比
